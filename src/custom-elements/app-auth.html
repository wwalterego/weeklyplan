<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">



<dom-module id="app-auth">
  <template>
    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }
      
    </style>

        <firebase-auth id="auth" user="{{user}}" on-error="handleError" statusKnown="{{statusKnown}}">
        </firebase-auth>


        <paper-input id="email" label="email"></paper-input>
        <paper-input id="password" label="password"></paper-input>
        <paper-button id="btnLogin" on-tap="login">Log in</paper-button>
        <paper-button id="btnSignup" on-tap="signup">Sign Up</paper-button>
        <paper-button id="btnLogout" on-tap="logout">Log Out</paper-button>
        <paper-button id="btnLogout" on-tap="login2">prova login</paper-button>
        <paper-button id="btnLogout" on-tap="writeData">write data</paper-button>
        <paper-button id="btnLogout" on-tap="googleLogin" hidden>google login</paper-button>
        <div id="userEmail">{{user.email}}</div>
        <div id="userUid" hidden>{{user.uid}}</div>

    </template>

  <script>
    Polymer({
      is: 'app-auth',

      properties: {
        email: {type: String},
        password: {type: String},
        user: {type: Object,notify:true, observer: '_userChangeHandler'}
      },

      login: function(){
          console.log('log in');

          var email = this.$.email.value;
          var password = this.$.password.value;
          
          this.$.auth.signInWithEmailAndPassword(email, password)
          .then(response => console.log(response))
          .catch(e => console.log(e));
      },

      signup: function(){
          console.log('SIGN up');
          
          var email = this.$.email.value;
          var password = this.$.password.value;
          this.$.auth.createUserWithEmailAndPassword(email, password);
      },

      logout: function(){
          console.log('log out');
          this.$.auth.signOut()
          .then(res => console.log(res))
          .catch(e => console.log(e));
      },

      login2: function(){
          this.$.auth.signInWithEmailAndPassword("walter.miani@gmail.com", "walter.miani@gmail.com");
      },

      googleLogin: function(){
          this.$.auth.signInWithPopup("google");
      },

      writeData: function(){
          
          fb.database().ref().child('users/' + this.user.uid).push({nome: "prova"});

          fb.database().ref().child('users/altro').push({nome: "prova"});

      },

      handleError: function(e){
          console.log(e);
      },

      _userChangeHandler: function(user){
          if(user){
            if(user.email == "walter.miani@gmail.com"){
               this.$.userEmail.innerHTML = "Admin";
            }       
          }
      }
    });
  </script>
</dom-module>