<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">


<dom-module id="event-list">
  <template>
    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }

      .eventContainer{
        border-bottom: 1px solid grey;
        padding: 10px;
      }
    </style>


    <!--<firebase-document
        id="document"
        app-name="weeklyplan"
        path="/asdasd"
        data="{{events}}">
    </firebase-document>-->

      <firebase-auth id="auth" app-name="weeklyplan" on-error="handleError">
      </firebase-auth>

      
      <firebase-query
          id="query"
          app-name="weeklyplan"
          path="/events"
          data="{{events}}">
      </firebase-query>

      <paper-button on-tap="tap">push me</paper-button>
      <paper-button on-tap="login">log me in</paper-button>
      <paper-button on-tap="logout">log me out</paper-button>


      <div>
      <template is="dom-repeat" items="[[events]]" as="event">
        <div class="eventContainer">
            <div><span>[[event.title]]<span>
              <paper-button raised on-tap="removeEvent">X</paper-button>
              <paper-button raised on-tap="openEdit">Edit</paper-button>
          </div>
        </div>
      </template>
       </div>


      <paper-dialog id="dialog">
       <h3>Edit event</h3>
       <paper-input label="Title" id="title"></paper-input>
        <paper-input label="Description" id="description"></paper-input>
        <paper-input label="Duration" id="duration"></paper-input>
        <paper-input label="Abbreviation" id="abbreviation"></paper-input>
            <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm autofocus on-tap="updateEvent">Accept</paper-button>
      </div>
     </paper-dialog>

    </template>

  <script>
    Polymer({
      is: 'event-list',

      properties: {
        events: {
          type: Array,
          notify: true,
          value: [],
          observer: 'dataChanged'
        },

        keyToUpdate: {type: String}
      },

      dataChanged: function(newData, oldData){
        console.log('data has changed');
      },

      tap: function(){
        console.log(this.$.query.data);
      },

      login: function(){

        var email = "walter.miani@gmail.com";
        var password = "walter.miani@gmail.com"
        this.$.auth.signInWithEmailAndPassword(email, password);
        
      },

      logout: function(){
      this.$.auth.signOut();
      },

      removeEvent: function(e){
        
          firebase.database().ref().child('/events/' + e.model.event.$key).remove();
      },

      openEdit: function(e){

        var event = e.model.event;

        this.$.title.value = event.title;
        this.$.description.value = event.description;
        this.$.duration.value = event.duration;
        this.$.abbreviation.value = event.abbreviation;

        this.$.dialog.open();


       	this.keyToUpdate = event.$key;
      },

      updateEvent(){
        
        var event = {
          title: this.$.title.value,
          desription: this.$.description.value,
          duration: this.$.duration.value,
          abbreviation: this.$.abbreviation.value 
        }

        firebase.database().ref().child('events/' + this.keyToUpdate + '/').update(event);

      }
    });
  </script>
</dom-module>