<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">


<dom-module id="event-manager">
  <template>
    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }
    </style>

  <app-messages id="messages"></app-messages>

    <div>
        <h1>EVENT MANAGER</h1>
        <paper-input label="Title" id="title" required auto-validate error-message="Required field" invalid="{{invalidValues.title}}"></paper-input>
        <paper-input label="Description" id="description"></paper-input>
        <paper-input label="Duration" id="duration" invalid="{{invalidValues.duration}}" required auto-validate allowed-pattern="[0-9]" error-message="Required numbers only field"></paper-input>
        <paper-input label="Abbreviation" id="abbreviation"></paper-input>
        <paper-button raised on-tap="addEvent" disabled="{{addDisabled}}">+</paper-button>
    </div>


    <div on-tap="tap">tap</div>
  
  </template>

  <script>
    Polymer({
      is: 'event-manager',

      properties:{
        user:{type:Object,notify:true},
        invalidValues:{type: Array, value:[],notify:true},
        addDisabled:{type: Boolean, value: false}
      },

      observers: [
        '_invalidValuesChanged(invalidValues.*)'
      ],

      addEvent: function(){
        
          var db = fb.database();

          var title = this.$.title.value;
          var description = this.$.description.value;
          var abbreviation = this.$.abbreviation.value;
          var duration = this.$.duration.value;
          
          var event = {
            title: title,
            description: description,
            abbreviation: abbreviation,
            duration: duration
          };
          
          db.ref().child('events/' + this.user.uid + '/').push(event);
          this.clearEvent();
          this.$.messages.modal("Event added","ok");

      },

      clearEvent: function(){
          this.$.title.value = "";
          this.$.description.value = "";
          this.$.abbreviation.value = "";
          this.$.duration.value = "";
      },

       _invalidValuesChanged : function(values) {
         this.addDisabled = false;
         for(index in this.invalidValues){  	
           if(this.invalidValues[index]){
              this.addDisabled = true;
           }
         }
        }
    });
  </script>
</dom-module>